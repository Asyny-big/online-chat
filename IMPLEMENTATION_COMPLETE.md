# üéØ –ì–æ–í–ß–∞—Ç ‚Äî –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ª–∏—á–Ω—ã–µ —á–∞—Ç—ã —Å –ø–æ–∏—Å–∫–æ–º

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### Backend
1. **–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Äî `GET /api/users/search?phone=7985`
   - –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –Ω–æ–º–µ—Ä—É
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ò—Å–∫–ª—é—á–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤** ‚Äî `POST /api/chats/private`
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `{ userId }` –∏–ª–∏ `{ phone }`
   - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ (–Ω–µ—Ç –¥—É–±–ª–µ–π)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —á–∞—Ç –µ—Å–ª–∏ –µ—Å—Ç—å

3. **–ú–æ–¥–µ–ª—å User** ‚Äî –ø–æ–ª–µ `phoneNormalized` —Å –∏–Ω–¥–µ–∫—Å–æ–º

### Frontend
1. **–ó–∞–º–µ–Ω–∞ channels ‚Üí chats**
   - `selectedChannel` ‚Üí `selectedChat`
   - `setChannels` ‚Üí `setChats`
   - –í—Å–µ API endpoints –æ–±–Ω–æ–≤–ª–µ–Ω—ã

2. **–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å debounce 300ms
   - –ñ–∏–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
   - –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ

3. **UX —É–ª—É—á—à–µ–Ω–∏—è**
   - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –ø–æ–∏—Å–∫–∞
   - Empty states
   - Skeleton loading
   - –ê–¥–∞–ø—Ç–∏–≤ (desktop + mobile)

---

## üöÄ –ó–∞–ø—É—Å–∫

### 1. Backend
```bash
cd backend
npm install
node scripts/drop-username-index.js  # –ï—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏
npm start
```

### 2. Frontend
```bash
cd frontend
npm install
npm start
```

---

## üìã –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ (–±–µ–∑ + –∏ –ø—Ä–æ–±–µ–ª–æ–≤)
2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –Ω–æ–º–µ—Ä–∞
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —á–∞—Ç —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã –Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
- `7985` ‚Äî –Ω–∞–π–¥—ë—Ç –≤—Å–µ –Ω–æ–º–µ—Ä–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å 7985
- `89` ‚Äî –Ω–∞–π–¥—ë—Ç –≤—Å–µ –Ω–æ–º–µ—Ä–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å 89

---

## üîß –î–µ–ø–ª–æ–π –Ω–∞ VPS

### –í–∞—Ä–∏–∞–Ω—Ç 1: Git Pull
```bash
cd /path/to/online-chat
git pull origin main
cd backend
node scripts/drop-username-index.js
pm2 restart all
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
```bash
mongosh "mongodb://localhost:27017/your-db-name" --eval "db.users.dropIndex('username_1')"
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Docker
```bash
docker exec -it mongodb mongosh --eval "db.users.dropIndex('username_1')"
docker-compose restart
```

---

## üì¶ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend
- `backend/routes/users.js` ‚Äî –ø–æ–∏—Å–∫ —Å —á–∞—Å—Ç–∏—á–Ω—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º
- `backend/routes/chats.js` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ userId
- `backend/models/User.js` ‚Äî phoneNormalized –∏–Ω–¥–µ–∫—Å
- `backend/scripts/drop-username-index.js` ‚Äî —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏

### Frontend
- `frontend/src/App.jsx` ‚Äî –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è + –ø–æ–∏—Å–∫
- `migrate-to-chats.ps1` ‚Äî –∞–≤—Ç–æ–º–∞—Ç. —Å–∫—Ä–∏–ø—Ç –∑–∞–º–µ–Ω—ã
- `MIGRATION_GUIDE.js` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∂–∏–≤—ã–º–∏
- [x] –ß–∞—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ
- [x] –ù–µ—Ç —Å–ª–æ–≤–∞ "–∫–∞–Ω–∞–ª" –≤ UI
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ 404 –≤ Network
- [x] –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [x] Socket.IO —Å—Ç–∞–±–∏–ª–µ–Ω
- [x] Mobile-friendly

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞ "duplicate key username_1"
```bash
cd backend
node scripts/drop-username-index.js
```

### –ü–æ–∏—Å–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω –∏ API –¥–æ—Å—Ç—É–ø–µ–Ω:
```bash
curl http://localhost:5000/api/users/search?phone=7985 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Frontend –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```bash
cd frontend
rm -rf node_modules build
npm install
npm start
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. Backend –ª–æ–≥–∏ (`pm2 logs` –∏–ª–∏ `docker logs`)
2. Frontend Console (F12)
3. Network tab (API –∑–∞–ø—Ä–æ—Å—ã)

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
