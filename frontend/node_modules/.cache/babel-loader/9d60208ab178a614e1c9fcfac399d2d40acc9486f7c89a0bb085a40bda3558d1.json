{"ast":null,"code":"import _objectSpread from\"C:/Users/larak/AppData/Local/npm-cache/_npx/cd53aabf71f3f793/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from\"react\";import axios from\"axios\";import{io}from\"socket.io-client\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_URL=\"http://localhost:5000/api\";export default function App(){const[token,setToken]=useState(localStorage.getItem(\"token\"));const[channels,setChannels]=useState([]);const[currentChannel,setCurrentChannel]=useState(null);const[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const[typing,setTyping]=useState(\"\");const[showCreate,setShowCreate]=useState(false);const[newChannelName,setNewChannelName]=useState(\"\");const[authMode,setAuthMode]=useState(\"login\");// \"login\" | \"register\"\nconst[username,setUsername]=useState(\"\");const[password,setPassword]=useState(\"\");const[error,setError]=useState(\"\");const socketRef=useRef(null);const messagesEndRef=useRef(null);// Функция для корректного декодирования JWT с поддержкой Unicode\nfunction parseJwt(token){const base64Url=token.split(\".\")[1];const base64=base64Url.replace(/-/g,\"+\").replace(/_/g,\"/\");const jsonPayload=decodeURIComponent(atob(base64).split(\"\").map(c=>\"%\"+(\"00\"+c.charCodeAt(0).toString(16)).slice(-2)).join(\"\"));return JSON.parse(jsonPayload);}// Загружаем список каналов при загрузке и при изменении токена\nuseEffect(()=>{if(token){axios.get(\"\".concat(API_URL,\"/channels\"),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>setChannels(res.data)).catch(()=>setChannels([]));socketRef.current=io(\"http://localhost:5000\",{auth:{token}});socketRef.current.on(\"message\",msg=>{setMessages(prev=>msg.channel===currentChannel?[...prev,msg]:prev);});socketRef.current.on(\"typing\",e=>setTyping(\"\".concat(e.user,\" \\u043F\\u0435\\u0447\\u0430\\u0442\\u0430\\u0435\\u0442...\")));return()=>{socketRef.current&&socketRef.current.disconnect();};}},[token]);// Загружаем сообщения выбранного канала\nuseEffect(()=>{if(token&&currentChannel){axios.get(\"\".concat(API_URL,\"/messages/\").concat(currentChannel),{headers:{Authorization:\"Bearer \".concat(token)}}).then(res=>setMessages(res.data));if(socketRef.current)socketRef.current.emit(\"join\",currentChannel);}},[token,currentChannel]);// Прокрутка вниз при изменении сообщений\nuseEffect(()=>{if(messagesEndRef.current){messagesEndRef.current.scrollIntoView({behavior:\"smooth\"});}},[messages]);// Подписка на новые сообщения по сокету\nuseEffect(()=>{if(!socketRef.current)return;const handler=msg=>{if(msg.channel===currentChannel){setMessages(prev=>[...prev,msg]);}};socketRef.current.on(\"message\",handler);return()=>{socketRef.current.off(\"message\",handler);};},[currentChannel]);// Создание канала\nconst handleCreateChannel=async()=>{if(!newChannelName.trim())return;try{const user=parseJwt(token).username;// Передаем массив с текущим пользователем\nlet t=parseJwt(token).username;if(typeof t!==\"string\"){if(typeof Buffer!==\"undefined\"&&Buffer.isBuffer(t)){t=Buffer.from(t).toString(\"utf8\");}else{t=String(t);}}t=t.trim();const res=await axios.post(\"\".concat(API_URL,\"/channels\"),{name:newChannelName,members:[t]},{headers:{Authorization:\"Bearer \".concat(token)}});setShowCreate(false);setNewChannelName(\"\");// Обновить список каналов\nconst channelsRes=await axios.get(\"\".concat(API_URL,\"/channels\"),{headers:{Authorization:\"Bearer \".concat(token)}});setChannels(channelsRes.data);setCurrentChannel(res.data._id);socketRef.current&&socketRef.current.emit(\"join\",res.data._id);}catch(_unused){alert(\"Ошибка создания канала\");}};// Отправка сообщения\nconst handleSend=()=>{if(!input.trim()||!currentChannel)return;const user=parseJwt(token).username;const msg={text:input,sender:user,channel:currentChannel};// Перед отправкой сообщения обязательно join в канал\nif(socketRef.current)socketRef.current.emit(\"join\",currentChannel);// Отправляем сообщение через сокет\nsocketRef.current.emit(\"message\",msg);// Сразу добавляем сообщение в локальный стейт\nsetMessages(prev=>[...prev,_objectSpread(_objectSpread({},msg),{},{_id:Date.now()})]);setInput(\"\");};// Аутентификация\nconst handleAuth=async()=>{setError(\"\");try{if(authMode===\"register\"){await axios.post(\"\".concat(API_URL,\"/register\"),{username,password});}const res=await axios.post(\"\".concat(API_URL,\"/login\"),{username,password});localStorage.setItem(\"token\",res.data.token);setToken(res.data.token);}catch(err){// Показываем ошибку с сервера, если есть\nif(err.response&&err.response.data&&err.response.data.error){setError(err.response.data.error);}else{setError(\"Неверный логин или пароль, либо пользователь не зарегистрирован\");}}};if(!token){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:authMode===\"register\"?\"Регистрация\":\"Вход\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:error}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0418\\u043C\\u044F\",value:username,onChange:e=>setUsername(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{onClick:handleAuth,children:authMode===\"register\"?\"Зарегистрироваться\":\"Войти\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setAuthMode(authMode===\"register\"?\"login\":\"register\"),children:authMode===\"register\"?\"Войти\":\"Регистрация\"})]});}return/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:220,paddingRight:10,borderRight:\"1px solid #ccc\"},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u041A\\u0430\\u043D\\u0430\\u043B\\u044B\"}),channels.length===0?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{color:\"#888\",marginBottom:8},children:\"\\u041D\\u0435\\u0442 \\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0445 \\u043A\\u0430\\u043D\\u0430\\u043B\\u043E\\u0432\"}),showCreate?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u0430\\u043D\\u0430\\u043B\\u0430\",value:newChannelName,onChange:e=>setNewChannelName(e.target.value),style:{width:\"90%\"}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCreateChannel,style:{marginTop:4},children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCreate(false),style:{marginLeft:4},children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"})]}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCreate(true),children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u043A\\u0430\\u043D\\u0430\\u043B\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[channels.map(ch=>/*#__PURE__*/_jsx(\"div\",{onClick:()=>setCurrentChannel(ch._id),style:{cursor:\"pointer\",background:currentChannel===ch._id?\"#eee\":\"\",padding:\"2px 0\"},children:ch.name},ch._id)),/*#__PURE__*/_jsx(\"button\",{style:{marginTop:10},onClick:()=>setShowCreate(v=>!v),children:showCreate?\"Скрыть создание\":\"Создать канал\"}),showCreate&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:4},children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u0430\\u043D\\u0430\\u043B\\u0430\",value:newChannelName,onChange:e=>setNewChannelName(e.target.value),style:{width:\"90%\"}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCreateChannel,style:{marginTop:4},children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C\"})]})]}),/*#__PURE__*/_jsx(\"button\",{style:{marginTop:20,color:\"red\"},onClick:()=>{localStorage.removeItem(\"token\");window.location.reload();},children:\"\\u0412\\u044B\\u0439\\u0442\\u0438\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,marginLeft:20},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0427\\u0430\\u0442\"}),/*#__PURE__*/_jsxs(\"div\",{style:{height:300,overflowY:\"auto\",border:\"1px solid #ccc\"},children:[messages.map(m=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"b\",{children:[m.sender,\":\"]}),\" \",m.text,m.fileUrl&&/*#__PURE__*/_jsx(\"a\",{href:m.fileUrl,target:\"_blank\",rel:\"noopener noreferrer\",children:\"[\\u0444\\u0430\\u0439\\u043B]\"})]},m._id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"div\",{children:typing}),/*#__PURE__*/_jsx(\"input\",{value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>{if(currentChannel){socketRef.current.emit(\"typing\",{channel:currentChannel});if(e.key===\"Enter\")handleSend();}},disabled:!currentChannel,placeholder:currentChannel?\"Введите сообщение...\":\"Выберите канал\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,disabled:!currentChannel||!input.trim(),children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]})]});}","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","io","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_URL","App","token","setToken","localStorage","getItem","channels","setChannels","currentChannel","setCurrentChannel","messages","setMessages","input","setInput","typing","setTyping","showCreate","setShowCreate","newChannelName","setNewChannelName","authMode","setAuthMode","username","setUsername","password","setPassword","error","setError","socketRef","messagesEndRef","parseJwt","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","get","concat","headers","Authorization","then","res","data","catch","current","auth","on","msg","prev","channel","e","user","disconnect","emit","scrollIntoView","behavior","handler","off","handleCreateChannel","trim","t","Buffer","isBuffer","from","String","post","name","members","channelsRes","_id","_unused","alert","handleSend","text","sender","_objectSpread","Date","now","handleAuth","setItem","err","response","children","style","color","placeholder","value","onChange","target","type","onClick","display","width","paddingRight","borderRight","length","marginBottom","marginTop","marginLeft","ch","cursor","background","padding","v","removeItem","window","location","reload","flex","height","overflowY","border","m","fileUrl","href","rel","ref","onKeyDown","key","disabled"],"sources":["D:/prr/prr/semak4/driver/frontend/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport axios from \"axios\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nconst API_URL = \"http://localhost:5000/api\";\r\n\r\nexport default function App() {\r\n  const [token, setToken] = useState(localStorage.getItem(\"token\"));\r\n  const [channels, setChannels] = useState([]);\r\n  const [currentChannel, setCurrentChannel] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [typing, setTyping] = useState(\"\");\r\n  const [showCreate, setShowCreate] = useState(false);\r\n  const [newChannelName, setNewChannelName] = useState(\"\");\r\n  const [authMode, setAuthMode] = useState(\"login\"); // \"login\" | \"register\"\r\n  const [username, setUsername] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const socketRef = useRef(null);\r\n  const messagesEndRef = useRef(null);\r\n\r\n  // Функция для корректного декодирования JWT с поддержкой Unicode\r\n  function parseJwt(token) {\r\n    const base64Url = token.split(\".\")[1];\r\n    const base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n    const jsonPayload = decodeURIComponent(\r\n      atob(base64)\r\n        .split(\"\")\r\n        .map((c) => \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2))\r\n        .join(\"\")\r\n    );\r\n    return JSON.parse(jsonPayload);\r\n  }\r\n\r\n  // Загружаем список каналов при загрузке и при изменении токена\r\n  useEffect(() => {\r\n    if (token) {\r\n      axios\r\n        .get(`${API_URL}/channels`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        })\r\n        .then((res) => setChannels(res.data))\r\n        .catch(() => setChannels([]));\r\n      socketRef.current = io(\"http://localhost:5000\", {\r\n        auth: { token },\r\n      });\r\n      socketRef.current.on(\"message\", (msg) => {\r\n        setMessages((prev) =>\r\n          msg.channel === currentChannel ? [...prev, msg] : prev\r\n        );\r\n      });\r\n      socketRef.current.on(\"typing\", (e) => setTyping(`${e.user} печатает...`));\r\n      return () => {\r\n        socketRef.current && socketRef.current.disconnect();\r\n      };\r\n    }\r\n  }, [token]);\r\n\r\n  // Загружаем сообщения выбранного канала\r\n  useEffect(() => {\r\n    if (token && currentChannel) {\r\n      axios\r\n        .get(`${API_URL}/messages/${currentChannel}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        })\r\n        .then((res) => setMessages(res.data));\r\n      if (socketRef.current) socketRef.current.emit(\"join\", currentChannel);\r\n    }\r\n  }, [token, currentChannel]);\r\n\r\n  // Прокрутка вниз при изменении сообщений\r\n  useEffect(() => {\r\n    if (messagesEndRef.current) {\r\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n    }\r\n  }, [messages]);\r\n\r\n  // Подписка на новые сообщения по сокету\r\n  useEffect(() => {\r\n    if (!socketRef.current) return;\r\n    const handler = (msg) => {\r\n      if (msg.channel === currentChannel) {\r\n        setMessages((prev) => [...prev, msg]);\r\n      }\r\n    };\r\n    socketRef.current.on(\"message\", handler);\r\n    return () => {\r\n      socketRef.current.off(\"message\", handler);\r\n    };\r\n  }, [currentChannel]);\r\n\r\n  // Создание канала\r\n  const handleCreateChannel = async () => {\r\n    if (!newChannelName.trim()) return;\r\n    try {\r\n      const user = parseJwt(token).username;\r\n      // Передаем массив с текущим пользователем\r\n      let t = parseJwt(token).username;\r\n      if (typeof t !== \"string\") {\r\n        if (typeof Buffer !== \"undefined\" && Buffer.isBuffer(t)) {\r\n          t = Buffer.from(t).toString(\"utf8\");\r\n        } else {\r\n          t = String(t);\r\n        }\r\n      }\r\n      t = t.trim();\r\n      const res = await axios.post(\r\n        `${API_URL}/channels`,\r\n        { name: newChannelName, members: [t] },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      setShowCreate(false);\r\n      setNewChannelName(\"\");\r\n      // Обновить список каналов\r\n      const channelsRes = await axios.get(`${API_URL}/channels`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      setChannels(channelsRes.data);\r\n      setCurrentChannel(res.data._id);\r\n      socketRef.current && socketRef.current.emit(\"join\", res.data._id);\r\n    } catch {\r\n      alert(\"Ошибка создания канала\");\r\n    }\r\n  };\r\n\r\n  // Отправка сообщения\r\n  const handleSend = () => {\r\n    if (!input.trim() || !currentChannel) return;\r\n    const user = parseJwt(token).username;\r\n    const msg = {\r\n      text: input,\r\n      sender: user,\r\n      channel: currentChannel,\r\n    };\r\n    // Перед отправкой сообщения обязательно join в канал\r\n    if (socketRef.current) socketRef.current.emit(\"join\", currentChannel);\r\n    // Отправляем сообщение через сокет\r\n    socketRef.current.emit(\"message\", msg);\r\n    // Сразу добавляем сообщение в локальный стейт\r\n    setMessages((prev) => [...prev, { ...msg, _id: Date.now() }]);\r\n    setInput(\"\");\r\n  };\r\n\r\n  // Аутентификация\r\n  const handleAuth = async () => {\r\n    setError(\"\");\r\n    try {\r\n      if (authMode === \"register\") {\r\n        await axios.post(`${API_URL}/register`, { username, password });\r\n      }\r\n      const res = await axios.post(`${API_URL}/login`, { username, password });\r\n      localStorage.setItem(\"token\", res.data.token);\r\n      setToken(res.data.token);\r\n    } catch (err) {\r\n      // Показываем ошибку с сервера, если есть\r\n      if (err.response && err.response.data && err.response.data.error) {\r\n        setError(err.response.data.error);\r\n      } else {\r\n        setError(\r\n          \"Неверный логин или пароль, либо пользователь не зарегистрирован\"\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!token) {\r\n    return (\r\n      <div>\r\n        <h2>{authMode === \"register\" ? \"Регистрация\" : \"Вход\"}</h2>\r\n        {error && <div style={{ color: \"red\" }}>{error}</div>}\r\n        <input\r\n          placeholder=\"Имя\"\r\n          value={username}\r\n          onChange={(e) => setUsername(e.target.value)}\r\n        />\r\n        <input\r\n          placeholder=\"Пароль\"\r\n          type=\"password\"\r\n          value={password}\r\n          onChange={(e) => setPassword(e.target.value)}\r\n        />\r\n        <button onClick={handleAuth}>\r\n          {authMode === \"register\" ? \"Зарегистрироваться\" : \"Войти\"}\r\n        </button>\r\n        <button onClick={() => setAuthMode(authMode === \"register\" ? \"login\" : \"register\")}>\r\n          {authMode === \"register\" ? \"Войти\" : \"Регистрация\"}\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ display: \"flex\" }}>\r\n      <div style={{ width: 220, paddingRight: 10, borderRight: \"1px solid #ccc\" }}>\r\n        <h3>Каналы</h3>\r\n        {channels.length === 0 ? (\r\n          <div>\r\n            <div style={{ color: \"#888\", marginBottom: 8 }}>\r\n              Нет доступных каналов\r\n            </div>\r\n            {showCreate ? (\r\n              <div>\r\n                <input\r\n                  placeholder=\"Название канала\"\r\n                  value={newChannelName}\r\n                  onChange={(e) => setNewChannelName(e.target.value)}\r\n                  style={{ width: \"90%\" }}\r\n                />\r\n                <button onClick={handleCreateChannel} style={{ marginTop: 4 }}>\r\n                  Создать\r\n                </button>\r\n                <button\r\n                  onClick={() => setShowCreate(false)}\r\n                  style={{ marginLeft: 4 }}\r\n                >\r\n                  Отмена\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <button onClick={() => setShowCreate(true)}>\r\n                Создать канал\r\n              </button>\r\n            )\r\n            }\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {channels.map((ch) => (\r\n              <div\r\n                key={ch._id}\r\n                onClick={() => setCurrentChannel(ch._id)}\r\n                style={{\r\n                  cursor: \"pointer\",\r\n                  background: currentChannel === ch._id ? \"#eee\" : \"\",\r\n                  padding: \"2px 0\",\r\n                }}\r\n              >\r\n                {ch.name}\r\n              </div>\r\n            ))}\r\n            <button\r\n              style={{ marginTop: 10 }}\r\n              onClick={() => setShowCreate((v) => !v)}\r\n            >\r\n              {showCreate ? \"Скрыть создание\" : \"Создать канал\"}\r\n            </button>\r\n            {showCreate && (\r\n              <div style={{ marginTop: 4 }}>\r\n                <input\r\n                  placeholder=\"Название канала\"\r\n                  value={newChannelName}\r\n                  onChange={(e) => setNewChannelName(e.target.value)}\r\n                  style={{ width: \"90%\" }}\r\n                />\r\n                <button onClick={handleCreateChannel} style={{ marginTop: 4 }}>\r\n                  Создать\r\n                </button>\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n        <button\r\n          style={{ marginTop: 20, color: \"red\" }}\r\n          onClick={() => {\r\n            localStorage.removeItem(\"token\");\r\n            window.location.reload();\r\n          }}\r\n        >\r\n          Выйти\r\n        </button>\r\n      </div>\r\n      <div style={{ flex: 1, marginLeft: 20 }}>\r\n        <h3>Чат</h3>\r\n        <div style={{ height: 300, overflowY: \"auto\", border: \"1px solid #ccc\" }}>\r\n          {messages.map((m) => (\r\n            <div key={m._id}>\r\n              <b>{m.sender}:</b>{\" \"}\r\n              {m.text}\r\n              {m.fileUrl && (\r\n                <a href={m.fileUrl} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                  [файл]\r\n                </a>\r\n              )}\r\n            </div>\r\n          ))}\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n        <div>{typing}</div>\r\n        <input\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          onKeyDown={(e) => {\r\n            if (currentChannel) {\r\n              socketRef.current.emit(\"typing\", { channel: currentChannel });\r\n              if (e.key === \"Enter\") handleSend();\r\n            }\r\n          }}\r\n          disabled={!currentChannel}\r\n          placeholder={\r\n            currentChannel\r\n              ? \"Введите сообщение...\"\r\n              : \"Выберите канал\"\r\n          }\r\n        />\r\n        <button\r\n          onClick={handleSend}\r\n          disabled={!currentChannel || !input.trim()}\r\n        >\r\n          Отправить\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}